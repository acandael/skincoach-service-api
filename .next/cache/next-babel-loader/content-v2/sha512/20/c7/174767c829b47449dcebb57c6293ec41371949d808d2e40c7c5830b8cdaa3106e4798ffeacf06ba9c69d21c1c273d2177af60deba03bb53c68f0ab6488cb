{"ast":null,"code":"/**\n * Example of a voucher register\n * You can customise this to call an external service\n * or keep static vouchers like this\n */\n//  const voucherRegister = [\n//   {\n//     code: \"no-shipping-cost\",\n//     discountAmount: 8,\n//     discountPercent: null,\n//     onlyForAuthorisedUser: false,\n//   }\n// ];\nmodule.exports = {\n  async get({\n    code,\n    context\n  }) {\n    const {\n      getVouchersFromCrystallize\n    } = require(\"./get-vouchers-from-crystallize\");\n\n    const vouchers = await getVouchersFromCrystallize();\n    const {\n      user\n    } = context;\n    const isAnonymousUser = !user || !user.email; // As default, not all the vouchers work for anonymous users.\n    // As you'll see in the configuration above, some need the user to be logged in\n\n    if (isAnonymousUser) {\n      const voucher = vouchers.filter(v => !v.onlyForAuthorisedUser).find(v => v.components[0].content.text === code);\n      return {\n        isValid: Boolean(voucher),\n        voucher\n      };\n    } // We assume that none of the vouchers have repeated codes\n\n\n    const voucher = vouchers.find(v => v.code === code);\n    return {\n      isValid: Boolean(voucher),\n      voucher\n    };\n  }\n\n};","map":{"version":3,"sources":["/Users/acandael/Sites/crystallize-app/src/services/voucher-service/index.js"],"names":["module","exports","get","code","context","getVouchersFromCrystallize","require","vouchers","user","isAnonymousUser","email","voucher","filter","v","onlyForAuthorisedUser","find","components","content","text","isValid","Boolean"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAA,MAAM,CAACC,OAAP,GAAiB;AACf,QAAMC,GAAN,CAAU;AAAEC,IAAAA,IAAF;AAAQC,IAAAA;AAAR,GAAV,EAA6B;AAE3B,UAAM;AACJC,MAAAA;AADI,QAEFC,OAAO,CAAC,iCAAD,CAFX;;AAIA,UAAMC,QAAQ,GAAG,MAAMF,0BAA0B,EAAjD;AAEA,UAAM;AAAEG,MAAAA;AAAF,QAAWJ,OAAjB;AAEA,UAAMK,eAAe,GAAG,CAACD,IAAD,IAAS,CAACA,IAAI,CAACE,KAAvC,CAV2B,CAY3B;AACA;;AACA,QAAID,eAAJ,EAAqB;AACnB,YAAME,OAAO,GAAGJ,QAAQ,CACrBK,MADa,CACLC,CAAD,IAAO,CAACA,CAAC,CAACC,qBADJ,EAEbC,IAFa,CAEPF,CAAD,IAAOA,CAAC,CAACG,UAAF,CAAa,CAAb,EAAgBC,OAAhB,CAAwBC,IAAxB,KAAiCf,IAFhC,CAAhB;AAIA,aAAO;AACLgB,QAAAA,OAAO,EAAEC,OAAO,CAACT,OAAD,CADX;AAELA,QAAAA;AAFK,OAAP;AAID,KAvB0B,CAyB3B;;;AACA,UAAMA,OAAO,GAAGJ,QAAQ,CAACQ,IAAT,CAAeF,CAAD,IAAOA,CAAC,CAACV,IAAF,KAAWA,IAAhC,CAAhB;AAEA,WAAO;AACLgB,MAAAA,OAAO,EAAEC,OAAO,CAACT,OAAD,CADX;AAELA,MAAAA;AAFK,KAAP;AAID;;AAjCc,CAAjB","sourcesContent":["/**\n * Example of a voucher register\n * You can customise this to call an external service\n * or keep static vouchers like this\n */\n\n\n//  const voucherRegister = [\n//   {\n//     code: \"no-shipping-cost\",\n//     discountAmount: 8,\n//     discountPercent: null,\n//     onlyForAuthorisedUser: false,\n//   }\n// ];\n\nmodule.exports = {\n  async get({ code, context }) {\n\n    const {\n      getVouchersFromCrystallize,\n    } = require(\"./get-vouchers-from-crystallize\");\n    \n    const vouchers = await getVouchersFromCrystallize();\n\n    const { user } = context;\n\n    const isAnonymousUser = !user || !user.email;\n\n    // As default, not all the vouchers work for anonymous users.\n    // As you'll see in the configuration above, some need the user to be logged in\n    if (isAnonymousUser) {\n      const voucher = vouchers\n        .filter((v) => !v.onlyForAuthorisedUser)\n        .find((v) => v.components[0].content.text === code);\n\n      return {\n        isValid: Boolean(voucher),\n        voucher,\n      };\n    }\n\n    // We assume that none of the vouchers have repeated codes\n    const voucher = vouchers.find((v) => v.code === code);\n\n    return {\n      isValid: Boolean(voucher),\n      voucher,\n    };\n  },\n};\n"]},"metadata":{},"sourceType":"script"}