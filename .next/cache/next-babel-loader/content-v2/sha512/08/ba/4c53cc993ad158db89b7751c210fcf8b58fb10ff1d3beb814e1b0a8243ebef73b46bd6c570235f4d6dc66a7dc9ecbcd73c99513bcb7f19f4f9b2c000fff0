{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nconst invariant = require(\"invariant\");\n\nconst fetch = require(\"node-fetch\");\n\nconst CRYSTALLIZE_TENANT_IDENTIFIER = process.env.CRYSTALLIZE_TENANT_IDENTIFIER;\nconst CRYSTALLIZE_SECRET_TOKEN = process.env.CRYSTALLIZE_SECRET_TOKEN;\nconst CRYSTALLIZE_SECRET_TOKEN_ID = process.env.CRYSTALLIZE_SECRET_TOKEN_ID;\ninvariant(CRYSTALLIZE_TENANT_IDENTIFIER, \"Missing process.env.CRYSTALLIZE_TENANT_IDENTIFIER\");\n\nfunction createApiCaller(uri) {\n  return async function callApi({\n    query,\n    variables,\n    operationName\n  }) {\n    invariant(CRYSTALLIZE_SECRET_TOKEN, \"Missing process.env.CRYSTALLIZE_SECRET_TOKEN\");\n    invariant(CRYSTALLIZE_SECRET_TOKEN_ID, \"Missing process.env.CRYSTALLIZE_SECRET_TOKEN_ID\");\n    const response = await fetch(uri, {\n      method: \"POST\",\n      headers: {\n        \"content-type\": \"application/json\",\n        \"X-Crystallize-Access-Token-Secret\": CRYSTALLIZE_SECRET_TOKEN,\n        \"X-Crystallize-Access-Token-Id\": CRYSTALLIZE_SECRET_TOKEN_ID\n      },\n      body: JSON.stringify({\n        operationName,\n        query,\n        variables\n      })\n    });\n    const json = await response.json();\n\n    if (json.errors) {\n      console.log(JSON.stringify(json.errors, null, 2));\n    }\n\n    return json;\n  };\n}\n\nfunction normalizeOrderModel(_ref) {\n  let {\n    customer,\n    cart\n  } = _ref,\n      rest = _objectWithoutProperties(_ref, [\"customer\", \"cart\"]);\n\n  return _objectSpread(_objectSpread(_objectSpread({}, rest), cart && {\n    cart: cart.map(function handleOrderCartItem(item) {\n      const {\n        images = [],\n        name,\n        sku,\n        productid,\n        productVariantId,\n        quantity,\n        price\n      } = item;\n      return {\n        name,\n        sku,\n        productid,\n        productVariantId,\n        quantity,\n        price,\n        imageUrl: images[0].url\n      };\n    })\n  }), customer && {\n    customer: {\n      firstName: customer.firstName || null,\n      lastName: customer.lastName || null,\n      addresses: customer.addresses || [{\n        type: \"billing\",\n        email: customer.email || undefined\n      }]\n    }\n  });\n}\n\nmodule.exports = {\n  normalizeOrderModel,\n\n  /**\n   * Catalogue API is the fast read-only API to query frontend\n   * related data\n   */\n  callCatalogueApi: createApiCaller(`https://api.crystallize.com/${CRYSTALLIZE_TENANT_IDENTIFIER}/catalogue`),\n\n  /**\n   * Orders API is the highly scalable API to send/read massive\n   * amounts of orders\n   */\n  callOrdersApi: createApiCaller(`https://api.crystallize.com/${CRYSTALLIZE_TENANT_IDENTIFIER}/orders`),\n\n  /**\n   * The PIM API is used for doing the ALL possible actions on\n   * a tenant or your user profile\n   */\n  callPimApi: createApiCaller(\"https://pim.crystallize.com/graphql\")\n};","map":{"version":3,"sources":["/Users/acandael/Sites/webshop-anniek/crystallize-app/src/services/crystallize/utils.js"],"names":["invariant","require","fetch","CRYSTALLIZE_TENANT_IDENTIFIER","process","env","CRYSTALLIZE_SECRET_TOKEN","CRYSTALLIZE_SECRET_TOKEN_ID","createApiCaller","uri","callApi","query","variables","operationName","response","method","headers","body","JSON","stringify","json","errors","console","log","normalizeOrderModel","customer","cart","rest","map","handleOrderCartItem","item","images","name","sku","productid","productVariantId","quantity","price","imageUrl","url","firstName","lastName","addresses","type","email","undefined","module","exports","callCatalogueApi","callOrdersApi","callPimApi"],"mappings":"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","sourcesContent":["const invariant = require(\"invariant\");\nconst fetch = require(\"node-fetch\");\n\nconst CRYSTALLIZE_TENANT_IDENTIFIER = process.env.CRYSTALLIZE_TENANT_IDENTIFIER;\nconst CRYSTALLIZE_SECRET_TOKEN = process.env.CRYSTALLIZE_SECRET_TOKEN;\nconst CRYSTALLIZE_SECRET_TOKEN_ID = process.env.CRYSTALLIZE_SECRET_TOKEN_ID;\n\ninvariant(\n  CRYSTALLIZE_TENANT_IDENTIFIER,\n  \"Missing process.env.CRYSTALLIZE_TENANT_IDENTIFIER\"\n);\n\nfunction createApiCaller(uri) {\n  return async function callApi({ query, variables, operationName }) {\n    invariant(\n      CRYSTALLIZE_SECRET_TOKEN,\n      \"Missing process.env.CRYSTALLIZE_SECRET_TOKEN\"\n    );\n    invariant(\n      CRYSTALLIZE_SECRET_TOKEN_ID,\n      \"Missing process.env.CRYSTALLIZE_SECRET_TOKEN_ID\"\n    );\n\n    const response = await fetch(uri, {\n      method: \"POST\",\n      headers: {\n        \"content-type\": \"application/json\",\n        \"X-Crystallize-Access-Token-Secret\": CRYSTALLIZE_SECRET_TOKEN,\n        \"X-Crystallize-Access-Token-Id\": CRYSTALLIZE_SECRET_TOKEN_ID,\n      },\n      body: JSON.stringify({ operationName, query, variables }),\n    });\n\n    const json = await response.json();\n\n    if (json.errors) {\n      console.log(JSON.stringify(json.errors, null, 2));\n    }\n\n    return json;\n  };\n}\n\nfunction normalizeOrderModel({ customer, cart, ...rest }) {\n  return {\n    ...rest,\n    ...(cart && {\n      cart: cart.map(function handleOrderCartItem(item) {\n        const {\n          images = [],\n          name,\n          sku,\n          productid,\n          productVariantId,\n          quantity,\n          price,\n        } = item;\n\n        return {\n          name,\n          sku,\n          productid,\n          productVariantId,\n          quantity,\n          price,\n          imageUrl: images[0].url,\n        };\n      }),\n    }),\n    ...(customer && {\n      customer: {\n        firstName: customer.firstName || null,\n        lastName: customer.lastName || null,\n        addresses: customer.addresses || [\n          {\n            type: \"billing\",\n            email: customer.email || undefined,\n          },\n        ],\n      },\n    }),\n  };\n}\n\nmodule.exports = {\n  normalizeOrderModel,\n\n  /**\n   * Catalogue API is the fast read-only API to query frontend\n   * related data\n   */\n  callCatalogueApi: createApiCaller(\n    `https://api.crystallize.com/${CRYSTALLIZE_TENANT_IDENTIFIER}/catalogue`\n  ),\n  /**\n   * Orders API is the highly scalable API to send/read massive\n   * amounts of orders\n   */\n  callOrdersApi: createApiCaller(\n    `https://api.crystallize.com/${CRYSTALLIZE_TENANT_IDENTIFIER}/orders`\n  ),\n  /**\n   * The PIM API is used for doing the ALL possible actions on\n   * a tenant or your user profile\n   */\n  callPimApi: createApiCaller(\"https://pim.crystallize.com/graphql\"),\n};\n"]},"metadata":{},"sourceType":"script"}