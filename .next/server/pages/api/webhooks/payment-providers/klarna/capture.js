"use strict";(()=>{var e={};e.id=995,e.ids=[995],e.modules={5854:e=>{e.exports=require("@crystallize/node-klarna")},7644:e=>{e.exports=require("invariant")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4809:e=>{e.exports=require("node-fetch")},1626:(e,r,a)=>{a.r(r),a.d(r,{config:()=>p,default:()=>d,routeModule:()=>u});var o={};a.r(o),a.d(o,{default:()=>webhookKlarnaCapture});var t=a(1802),n=a(7153),s=a(6249),i=a(5840),l=a.n(i);async function webhookKlarnaCapture(e,r){try{console.log("webhookKlarnaCapture",e.query),await l()({crystallizeOrderId:e.query.crystallizeOrderId}),r.status(200).send("ok")}catch(e){console.log("Error at klarnaCapture webhook"),console.log(e),r.status(500).send("error")}}let d=(0,s.l)(o,"default"),p=(0,s.l)(o,"config"),u=new t.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/webhooks/payment-providers/klarna/capture",pathname:"/api/webhooks/payment-providers/klarna/capture",bundlePath:"",filename:""},userland:o})},5840:(e,r,a)=>{let o=a(6784),{getClient:t}=a(6062);e.exports=async function({crystallizeOrderId:e}){let r=await o.orders.getOrder(e),a=JSON.parse(r.additionalInformation),n=await t(),{error:s,response:i}=await n.ordermanagementV1.captures.capture(a.klarnaOrderId);console.log(s,i)}},6062:(e,r,a)=>{let o;let t=a(7644),{Klarna:n}=a(5854),s=process.env.KLARNA_USERNAME,i=process.env.KLARNA_PASSWORD;e.exports={getClient:()=>(t(s,"process.env.KLARNA_USERNAME is not defined"),t(i,"process.env.KLARNA_PASSWORD is not defined"),!o&&s&&i&&(o=new n({username:s,password:i,apiEndpoint:"api.playground.klarna.com"})),o)}}};var r=require("../../../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[222,784],()=>__webpack_exec__(1626));module.exports=a})();