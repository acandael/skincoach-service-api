"use strict";(()=>{var e={};e.id=97,e.ids=[97],e.modules={5854:e=>{e.exports=require("@crystallize/node-klarna")},2139:e=>{e.exports=require("@sendgrid/mail")},7644:e=>{e.exports=require("invariant")},2009:e=>{e.exports=require("mjml")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4809:e=>{e.exports=require("node-fetch")},8544:(e,r,a)=>{a.r(r),a.d(r,{config:()=>p,default:()=>l,routeModule:()=>u});var o={};a.r(o),a.d(o,{default:()=>webhookKlarnaPush});var n=a(1802),s=a(7153),t=a(6249),i=a(8590),d=a.n(i);async function webhookKlarnaPush(e,r){try{console.log("webhookKlarnaPush",e.query),await d()({crystallizeOrderId:e.query.crystallizeOrderId,klarnaOrderId:e.query.klarnaOrderId}),r.status(200).send("ok")}catch(e){console.log("Error at klarnaPush webhook"),console.log(e),r.status(500).send("error")}}let l=(0,t.l)(o,"default"),p=(0,t.l)(o,"config"),u=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/webhooks/payment-providers/klarna/push",pathname:"/api/webhooks/payment-providers/klarna/push",bundlePath:"",filename:""},userland:o})},8590:(e,r,a)=>{let o=a(8958),{getClient:n}=a(6062);e.exports=async function({crystallizeOrderId:e,klarnaOrderId:r}){let a=await n();await a.ordermanagementV1.orders.acknowledge(r),await o.sendOrderConfirmation(e)}},6062:(e,r,a)=>{let o;let n=a(7644),{Klarna:s}=a(5854),t=process.env.KLARNA_USERNAME,i=process.env.KLARNA_PASSWORD;e.exports={getClient:()=>(n(t,"process.env.KLARNA_USERNAME is not defined"),n(i,"process.env.KLARNA_PASSWORD is not defined"),!o&&t&&i&&(o=new s({username:t,password:i,apiEndpoint:"api.playground.klarna.com"})),o)}}};var r=require("../../../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[222,784,958],()=>__webpack_exec__(8544));module.exports=a})();